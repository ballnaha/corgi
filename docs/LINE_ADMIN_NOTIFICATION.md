# LINE Admin Notification Setup Guide

## р╕ар╕▓р╕Юр╕гр╕зр╕б
р╕гр╕░р╕Ър╕Ър╕Ир╕░р╕кр╣Ир╕З LINE notification р╣Гр╕лр╣Й admin р╣Ар╕бр╕╖р╣Ир╕нр╕бр╕╡р╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕нр╣Гр╕лр╕бр╣Ир╣Ар╕Вр╣Йр╕▓р╕бр╕▓ р╕Чр╕▒р╣Йр╕Зр╕Ир╕▓р╕Бр╕Бр╕▓р╕гр╕Кр╕│р╕гр╕░р╕Фр╣Йр╕зр╕в:
- **р╕Ър╕▒р╕Хр╕гр╣Ар╕Др╕гр╕Фр╕┤р╕Х (Stripe)** - р╕кр╣Ир╕Зр╕Чр╕▒р╕Щр╕Чр╕╡р╣Ар╕бр╕╖р╣Ир╕нр╕Кр╕│р╕гр╕░р╕кр╕│р╣Ар╕гр╣Зр╕Ир╕Ьр╣Ир╕▓р╕Щ webhook
- **р╣Вр╕нр╕Щр╣Ар╕Зр╕┤р╕Щр╕Ьр╣Ир╕▓р╕Щр╕Шр╕Щр╕▓р╕Др╕▓р╕г** - р╕кр╣Ир╕Зр╕Чр╕▒р╕Щр╕Чр╕╡р╣Ар╕бр╕╖р╣Ир╕нр╕ер╕╣р╕Бр╕Др╣Йр╕▓р╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕н (р╕кр╕Цр╕▓р╕Щр╕░ PENDING)
- **р╕зр╕┤р╕Шр╕╡р╕нр╕╖р╣Ир╕Щр╣Ж** - р╕кр╣Ир╕Зр╕Чр╕▒р╕Щр╕Чр╕╡р╣Ар╕бр╕╖р╣Ир╕нр╕ер╕╣р╕Бр╕Др╣Йр╕▓р╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕н

## р╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓

### 1. р╕лр╕▓ LINE User ID р╕Вр╕нр╕З Admin

#### р╕зр╕┤р╕Шр╕╡р╕Чр╕╡р╣И 1: р╣Гр╕Кр╣Й Official Account Manager
1. р╣Др╕Ыр╕Чр╕╡р╣И https://developers.line.biz/console/
2. р╣Ар╕ер╕╖р╕нр╕Б Provider р╣Бр╕ер╕░ Channel р╕Вр╕нр╕Зр╕Др╕╕р╕У
3. р╣Др╕Ыр╕Чр╕╡р╣Ир╣Бр╕Чр╣Зр╕Ъ "Messaging API"
4. р╣Ар╕ер╕╖р╣Ир╕нр╕Щр╕ер╕Зр╕бр╕▓р╕лр╕▓р╕кр╣Ир╕зр╕Щ "Your user ID"
5. р╕Др╕▒р╕Фр╕ер╕нр╕Б User ID (р╕гр╕╣р╕Ыр╣Бр╕Ър╕Ъ: `Uxxxxxxxxxxxxxxxxx`)

#### р╕зр╕┤р╕Шр╕╡р╕Чр╕╡р╣И 2: р╣Гр╕Кр╣Й Webhook Test
1. р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕нр╕░р╣Др╕гр╕Бр╣Зр╣Др╕Фр╣Йр╣Др╕Ыр╕Чр╕╡р╣И Official Account р╕Вр╕нр╕Зр╕Др╕╕р╕У
2. р╕Фр╕╣р╣Гр╕Щ webhook logs р╕Ир╕░р╣Ар╕лр╣Зр╕Щ `userId` р╣Гр╕Щр╕кр╣Ир╕зр╕Щ `source`

### 2. р╣Ар╕Юр╕┤р╣Ир╕б Environment Variable

р╣Бр╕Бр╣Йр╣Др╕Вр╣Др╕Яр╕ер╣М `.env.local`:

```bash
# LINE Admin Notification
LINE_ADMIN_USER_ID=U1234567890abcdefghijklmnopqrstu
```

**р╕лр╕бр╕▓р╕вр╣Ар╕лр╕Хр╕╕:** 
- р╕лр╣Йр╕▓р╕бр╕бр╕╡р╣Ар╕Др╕гр╕╖р╣Ир╕нр╕Зр╕лр╕бр╕▓р╕в quotes (" р╕лр╕гр╕╖р╕н ')
- User ID р╕Хр╣Йр╕нр╕Зр╕Вр╕╢р╣Йр╕Щр╕Хр╣Йр╕Щр╕Фр╣Йр╕зр╕в `U` р╣Бр╕ер╕░р╕бр╕╡р╕Др╕зр╕▓р╕бр╕вр╕▓р╕з 33 р╕Хр╕▒р╕зр╕нр╕▒р╕Бр╕йр╕г

### 3. Restart Application

р╕лр╕ер╕▒р╕Зр╕Ир╕▓р╕Бр╣Ар╕Юр╕┤р╣Ир╕б environment variable р╣Бр╕ер╣Йр╕з р╕Хр╣Йр╕нр╕З restart application:

```bash
# Development
npm run dev

# Production
npm run build
npm start
```

## р╕гр╕╣р╕Ыр╣Бр╕Ър╕Ъ Notification

### р╕кр╕│р╕лр╕гр╕▒р╕Ъ User (р╕ер╕╣р╕Бр╕Др╣Йр╕▓)
р╣Др╕Фр╣Йр╕гр╕▒р╕Ър╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕Ир╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╣Бр╕Ър╕Ър╣Ар╕Хр╣Зр╕б р╕Ыр╕гр╕░р╕Бр╕нр╕Ър╕Фр╣Йр╕зр╕в:
- р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕н (Order Number, Customer Name, Phone)
- р╕гр╕▓р╕вр╕Бр╕▓р╕гр╕кр╕┤р╕Щр╕Др╣Йр╕▓р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (р╕кр╕╣р╕Зр╕кр╕╕р╕Ф 5 р╕гр╕▓р╕вр╕Бр╕▓р╕гр╣Бр╕гр╕Б)
- р╕кр╕гр╕╕р╕Ыр╕Бр╕▓р╕гр╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щ (р╕вр╕нр╕Фр╕гр╕зр╕б, р╕Др╣Ир╕▓р╕Ир╕▒р╕Фр╕кр╣Ир╕З, р╕кр╣Ир╕зр╕Щр╕ер╕Ф)
- р╕кр╕Цр╕▓р╕Щр╕░р╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕н
- р╕Чр╕╡р╣Ир╕нр╕вр╕╣р╣Ир╕Ир╕▒р╕Фр╕кр╣Ир╕З

### р╕кр╕│р╕лр╕гр╕▒р╕Ъ Admin
р╣Др╕Фр╣Йр╕гр╕▒р╕Ъ notification р╣Бр╕Ър╕Ър╕вр╣Ир╕н р╕Ыр╕гр╕░р╕Бр╕нр╕Ър╕Фр╣Йр╕зр╕в:
- ЁЯФФ р╕лр╕▒р╕зр╕Вр╣Йр╕н "р╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕нр╣Гр╕лр╕бр╣И!"
- Order Number
- р╕Кр╕╖р╣Ир╕нр╕ер╕╣р╕Бр╕Др╣Йр╕▓ р╣Бр╕ер╕░ р╣Ар╕Ър╕нр╕гр╣Мр╣Вр╕Чр╕г
- **р╕гр╕▓р╕вр╕Бр╕▓р╕гр╕кр╕┤р╕Щр╕Др╣Йр╕▓ (3 р╕нр╕▒р╕Щр╣Бр╕гр╕Б р╕Юр╕гр╣Йр╕нр╕бр╕гр╕▓р╕Др╕▓)**
- р╕Ир╕│р╕Щр╕зр╕Щр╕кр╕┤р╕Щр╕Др╣Йр╕▓р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф
- р╕зр╕┤р╕Шр╕╡р╕Бр╕▓р╕гр╕Ир╕▒р╕Фр╕кр╣Ир╕З
- **р╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╣Ар╕Бр╣Зр╕Ъ** (р╕бр╕▒р╕Фр╕Ир╕│р╕лр╕гр╕╖р╕нр╣Ар╕Хр╣Зр╕бр╕Ир╕│р╕Щр╕зр╕Щ)
- р╕кр╕Цр╕▓р╕Щр╕░р╕Бр╕▓р╕гр╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щ (р╕Кр╕│р╕гр╕░р╣Бр╕ер╣Йр╕з/р╕гр╕нр╕Кр╕│р╕гр╕░)
- р╕зр╕┤р╕Шр╕╡р╕Бр╕▓р╕гр╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щ (р╕Ър╕▒р╕Хр╕гр╣Ар╕Др╕гр╕Фр╕┤р╕Х/р╣Вр╕нр╕Щр╣Ар╕Зр╕┤р╕Щ)
- р╕Чр╕╡р╣Ир╕нр╕вр╕╣р╣Ир╕Ир╕▒р╕Фр╕кр╣Ир╕З (р╣Бр╕Ър╕Ър╕вр╣Ир╕н)
- р╕Ыр╕╕р╣Ир╕б "р╕Фр╕╣р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╣Ар╕Хр╣Зр╕б" тЖТ р╣Др╕Ыр╕Чр╕╡р╣Ир╕лр╕Щр╣Йр╕▓ Admin Orders

## р╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щ

### р╕Бр╕гр╕Ур╕╡: р╕ер╕╣р╕Бр╕Др╣Йр╕▓р╕Кр╕│р╕гр╕░р╕Фр╣Йр╕зр╕вр╕Ър╕▒р╕Хр╕гр╣Ар╕Др╕гр╕Фр╕┤р╕Х (Stripe)
1. р╕ер╕╣р╕Бр╕Др╣Йр╕▓р╕Бр╕Фр╕Ыр╕╕р╣Ир╕б "р╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щ" тЖТ р╣Др╕Ыр╕лр╕Щр╣Йр╕▓ Stripe Checkout
2. р╕ер╕╣р╕Бр╕Др╣Йр╕▓р╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щр╕кр╕│р╣Ар╕гр╣Зр╕И
3. Stripe р╕кр╣Ир╕З webhook р╕бр╕▓р╕Чр╕╡р╣И `/api/stripe/webhook`
4. р╕гр╕░р╕Ър╕Ър╕кр╕гр╣Йр╕▓р╕З order р╕Фр╣Йр╕зр╕вр╕кр╕Цр╕▓р╕Щр╕░ `CONFIRMED`
5. **р╕кр╣Ир╕З notification р╣Гр╕лр╣Й user** (р╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕Ир╣Ар╕Хр╣Зр╕б)
6. **р╕кр╣Ир╕З notification р╣Гр╕лр╣Й admin** (р╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕нр╣Гр╕лр╕бр╣И)

### р╕Бр╕гр╕Ур╕╡: р╕ер╕╣р╕Бр╕Др╣Йр╕▓р╕Кр╕│р╕гр╕░р╕Фр╣Йр╕зр╕вр╣Вр╕нр╕Щр╣Ар╕Зр╕┤р╕Щ/р╕зр╕┤р╕Шр╕╡р╕нр╕╖р╣Ир╕Щр╣Ж
1. р╕ер╕╣р╕Бр╕Др╣Йр╕▓р╕Бр╕Фр╕Ыр╕╕р╣Ир╕б "р╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щ"
2. р╕гр╕░р╕Ър╕Ър╕кр╕гр╣Йр╕▓р╕З order р╕Фр╣Йр╕зр╕вр╕кр╕Цр╕▓р╕Щр╕░ `PENDING`
3. **р╕кр╣Ир╕З notification р╣Гр╕лр╣Й user** (р╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И + р╣Бр╕Ир╣Йр╕Зр╣Гр╕лр╣Йр╣Вр╕нр╕Щр╣Ар╕Зр╕┤р╕Щ)
4. **р╕кр╣Ир╕З notification р╣Гр╕лр╣Й admin** (р╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕нр╣Гр╕лр╕бр╣И)

## р╕Вр╣Йр╕нр╕Фр╕╡р╕Вр╕нр╕Зр╕гр╕░р╕Ър╕Ъ

тЬЕ **р╕кр╕│р╕лр╕гр╕▒р╕Ъ Admin:**
- р╕гр╕▒р╕Ър╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╕Чр╕▒р╕Щр╕Чр╕╡р╣Ар╕бр╕╖р╣Ир╕нр╕бр╕╡р╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕нр╣Гр╕лр╕бр╣И
- р╕Фр╕╣р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕гр╕╕р╕Ыр╣Др╕Фр╣Йр╕Чр╕▒р╕Щр╕Чр╕╡р╣Вр╕Фр╕вр╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╣Ар╕Ыр╕┤р╕Ф Admin Panel
- **р╣Ар╕лр╣Зр╕Щр╕гр╕▓р╕вр╕Бр╕▓р╕гр╕кр╕┤р╕Щр╕Др╣Йр╕▓ 3 р╕нр╕▒р╕Щр╣Бр╕гр╕Бр╕Юр╕гр╣Йр╕нр╕бр╕гр╕▓р╕Др╕▓** (р╕Цр╣Йр╕▓р╕бр╕╡р╕бр╕▓р╕Бр╕Бр╕зр╣Ир╕▓ 3 р╕Ир╕░р╕Ър╕нр╕Бр╕Ир╕│р╕Щр╕зр╕Щр╕Чр╕╡р╣Ир╣Ар╕лр╕ер╕╖р╕н)
- р╕Др╕ер╕┤р╕Бр╕Ыр╕╕р╣Ир╕бр╣Ар╕Фр╕╡р╕вр╕зр╣Др╕Ыр╕Фр╕╣р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╣Ар╕Хр╣Зр╕бр╣Др╕Фр╣Йр╣Ар╕ер╕в
- р╣Бр╕вр╕Бр╣Бр╕вр╕░р╣Др╕Фр╣Йр╕Кр╕▒р╕Фр╕зр╣Ир╕▓р╕Кр╕│р╕гр╕░р╣Бр╕ер╣Йр╕зр╕лр╕гр╕╖р╕нр╕вр╕▒р╕З

тЬЕ **р╕кр╕│р╕лр╕гр╕▒р╕Ъ User:**
- р╣Др╕Фр╣Йр╕гр╕▒р╕Ър╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕Ир╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щ
- р╕кр╕▓р╕бр╕▓р╕гр╕Цр╕Фр╕╣р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕нр╣Др╕Фр╣Йр╕Чр╕╕р╕Бр╣Ар╕бр╕╖р╣Ир╕н
- р╣Др╕бр╣Ир╕гр╕Ър╕Бр╕зр╕Щ admin р╣Гр╕Щр╕Бр╕▓р╕гр╕Вр╕нр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И

тЬЕ **р╕кр╕│р╕лр╕гр╕▒р╕Ър╕гр╕░р╕Ър╕Ъ:**
- р╣Др╕бр╣Ир╕кр╣Ир╕З spam (р╣Бр╕вр╕Бр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б user/admin р╕Кр╕▒р╕Фр╣Ар╕Ир╕Щ)
- р╕Цр╣Йр╕▓р╕кр╣Ир╕Зр╣Гр╕лр╣Й admin р╣Др╕бр╣Ир╕кр╕│р╣Ар╕гр╣Зр╕И р╕вр╕▒р╕Зр╕кр╣Ир╕Зр╣Гр╕лр╣Й user р╣Др╕Фр╣Йр╕Ыр╕Бр╕Хр╕┤
- Graceful degradation (р╕Цр╣Йр╕▓р╣Др╕бр╣Ир╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ LINE_ADMIN_USER_ID р╕Бр╣Зр╣Др╕бр╣И error)

## Troubleshooting

### р╣Др╕бр╣Ир╣Др╕Фр╣Йр╕гр╕▒р╕Ъ notification
1. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ `LINE_ADMIN_USER_ID` р╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╕лр╕гр╕╖р╕нр╣Др╕бр╣И
2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ LINE Channel Access Token р╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╣Др╕Фр╣Йр╕лр╕гр╕╖р╕нр╣Др╕бр╣И
3. р╕Фр╕╣ logs р╣Гр╕Щ console:
   ```
   ЁЯСитАНЁЯТ╝ Sending admin notification to: Uxxxxx...
   тЬЕ Admin notification sent successfully
   ```

### р╣Др╕Фр╣Йр╕гр╕▒р╕Ъ notification р╣Бр╕Хр╣Ир╣Др╕бр╣Ир╕Др╕гр╕Ъ
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ restart application р╣Бр╕ер╣Йр╕зр╕лр╕гр╕╖р╕нр╕вр╕▒р╕З
- р╕ер╕нр╕З clear cache р╕Вр╕нр╕З LINE app

### Error: "LINE_API_NOT_CONFIGURED"
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ `LINE_CHANNEL_ACCESS_TOKEN` р╣Гр╕Щр╣Др╕Яр╕ер╣М `.env.local`
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ token р╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╣Бр╕ер╕░р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕лр╕бр╕Фр╕нр╕▓р╕вр╕╕

## Logs р╕Чр╕╡р╣Ир╕Др╕зр╕гр╣Ар╕лр╣Зр╕Щ

```
ЁЯЪА LINE API called
ЁЯФН Request source check:
  User-Agent: ...
  Is webhook call: false/true
ЁЯУЭ Parsing receipt data...
тЬЕ Flex message created successfully
ЁЯЪА Calling sendLineMessage...
ЁЯОп Target LINE User ID: Uxxxxx...
ЁЯУи sendLineMessage completed with status: 200
ЁЯСитАНЁЯТ╝ Sending admin notification to: Uxxxxx...
тЬЕ Admin notification sent successfully with status: 200
```

## Security Note

тЪая╕П **р╕Вр╣Йр╕нр╕Др╕зр╕гр╕гр╕░р╕зр╕▒р╕З:**
- р╕нр╕вр╣Ир╕▓ commit р╣Др╕Яр╕ер╣М `.env.local` р╕ер╕З Git
- LINE_ADMIN_USER_ID р╣Ар╕Ыр╣Зр╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╣Ир╕зр╕Щр╕Хр╕▒р╕з
- р╣Гр╕Кр╣Й LINE Official Account р╕Чр╕╡р╣Ир╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕Др╕зр╕▓р╕бр╕Ыр╕ер╕нр╕Фр╕ар╕▒р╕вр╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕в
